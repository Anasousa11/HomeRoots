<!-- core/templates/core/progress.html -->
{% extends 'core/base.html' %}

{% block content %}
<div class="container my-5">
    <h2>{{ student.first_name }} {{ student.last_name }} - Progress</h2>

    <!-- Completed Lessons Table -->
    <h4 class="mt-4">Completed Lessons</h4>
    {% if completed %}
    <table class="table table-striped mt-2">
        <thead>
            <tr>
                <th>Lesson</th>
                <th>Subject</th>
                <th>Level</th>
                <th>Grade</th>
                <th>Completed At</th>
            </tr>
        </thead>
        <tbody>
            {% for record in completed %}
            <tr>
                <td>{{ record.lesson.title }}</td>
                <td>{{ record.lesson.get_subject_display }}</td>
                <td>{{ record.lesson.get_level_display }}</td>
                <td>{{ record.grade|default:"N/A" }}</td>
                <td>{{ record.completed_at|date:"d M Y" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No lessons completed yet.</p>
    {% endif %}

    <!-- Grades Pie Chart -->
    <h4 class="mt-5">Grade Distribution</h4>
    <canvas id="gradesChart" width="400" height="400"></canvas>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('gradesChart').getContext('2d');
const gradesData = {
    labels: {{ grade_counts.keys|list|safe }},
    datasets: [{
        label: 'Number of Lessons',
        data: {{ grade_counts.values|list|safe }},
        backgroundColor: [
            'rgba(75, 192, 192, 0.6)',
            'rgba(54, 162, 235, 0.6)',
            'rgba(255, 206, 86, 0.6)',
            'rgba(255, 99, 132, 0.6)'
        ],
        borderColor: [
            'rgba(75, 192, 192, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(255, 99, 132, 1)'
        ],
        borderWidth: 1
    }]
};

const gradesChart = new Chart(ctx, {
    type: 'pie',
    data: gradesData,
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            },
            title: {
                display: true,
                text: 'Grade Distribution'
            }
        }
    }
});
</script>
{% endblock %}
